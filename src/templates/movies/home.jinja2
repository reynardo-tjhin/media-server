<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movies</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='movies/home.css') }}">

    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css" rel="stylesheet">
</head>
<body class="bg-dark">
    {# navigation bar #}
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top shadow-sm">
        <div class="container-fluid">
            {# Logo #}
            <a class="navbar-brand" href="{{ url_for('admin.home') }}">
                <svg width="200" height="60" viewBox="0 0 200 60" xmlns="http://www.w3.org/2000/svg">
                    <!-- Background circle for the icon -->
                    <circle cx="30" cy="30" r="25" fill="url(#gradient1)" stroke-width="2"/>
                    
                    <!-- Server/Media icon - stylized play button with server lines -->
                    <polygon points="22,20 22,40 38,30" fill="black" opacity="0.9"/>
                    <rect x="40" y="24" width="8" height="2" rx="1" fill="black" opacity="0.7"/>
                    <rect x="40" y="28" width="12" height="2" rx="1" fill="black" opacity="0.7"/>
                    <rect x="40" y="32" width="8" height="2" rx="1" fill="black" opacity="0.7"/>
                    <rect x="40" y="36" width="6" height="2" rx="1" fill="black" opacity="0.7"/>
                
                    <!-- Company name text -->
                    <text x="65" y="25" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="url(#textGradient)">Tjhin Media</text>
                    <text x="65" y="42" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="url(#textGradient)" opacity="0.8">Server</text>
                
                    <!-- Gradients -->
                    <defs>
                        <!-- the background of the play button -->
                        <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:white;stop-opacity:0.9" />
                        </linearGradient>
                        
                        <!-- the font colors -->
                        <linearGradient id="textGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:white;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                </svg>
            </a>

            {# Mobile menu toggle button #}
            <button class="navbar-toggle" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggle-icon"></span>
            </button>

            <!-- Navigation Menu -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a href="{{ url_for('movies.home') }}" class="nav-link active">Movies</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">TV Shows</a>
                    </li>
                </ul>

                {# Search section #}
                <form method="get" class="d-flex search-form" role="search">
                    <div class="input-group">
                        <input name="movie-name" class="form-control bg-secondary border-secondary text-white" type="search" placeholder="Search movies..." aria-label="Search">
                        <button class="btn btn-outline-light" type="submit">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </nav>

    {# gallery of movies #}
    <div class="gallery-container">
        {# title of the page #}
        <h1 class="gallery-title">Downloaded Movies</h1>

        {# shows the gallery of movies #}
        <div class="movie-list">

            {% for movie in movies %}
            {# the individual movie #}
            <div class="movie-card" id="{{ movie.name }}">
                <a href="#">
                    <img class="movie-poster" 
                         src="{{ url_for('static', filename='posters/' + movie.name + '.webp') }}"
                         alt="{{ movie.name }}"
                         loading="lazy">
                    <div class="movie-title-overlay">
                        <h3 class="movie-name">{{ movie.name }}</h3>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>

    {# info for each movie #}
    {% for movie in movies %}
    <div class="tooltip" id="{{ movie.name }}-tooltip">
        {# name and release date #}
        <div class="tooltip-header">
            <div class="tooltip-title">{{ movie.name }}</div>
            <div class="tooltip-year">{{ movie.release_date }}</div>
        </div>

        {# ratings #}
        <div class="tooltip-info">
            <div class="tooltip-info-item">
                <div class="tooltip-info-label">IMDb Rating</div>
                <div class="tooltip-info-value">
                    <span class="tooltip-rating">{{ movie.imdb_rating }}</span>
                </div>
            </div>
            <div class="tooltip-info-item">
                <div class="tooltip-info-label">Rotten Tomatoes Rating</div>
                <div class="tooltip-info-value">
                    <span class="tooltip-rating">{{ movie.rotten_tomatoes_rating }}</span>
                </div>
            </div>
            <div class="tooltip-info-item">
                <div class="tooltip-info-label">Metacritic Rating</div>
                <div class="tooltip-info-value">
                    <span class="tooltip-rating">{{ movie.metacritic_rating }}</span>
                </div>
            </div>
        </div>

        {# genres #}
        <div class="tooltip-info-item">
            <div class="tooltip-info-label">Genre</div>
            <div class="tooltip-info-value">
                {% if movie.genres %}
                    {% for genre in movie.genres.split(', ') %}
                        <span class="tooltip-genre">{{ genre }}</span>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
        
        {# description #}
        <div class="tooltip-description">{{ movie.description }}</div>
    </div>
    {% endfor %}

    <!-- Bootstrap JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

    {# for tool tip #}
    <script>
        // tooltip
        document.querySelectorAll(".movie-card").forEach(movieCard => {
            // mouse enters the area, show the tooltip
            movieCard.addEventListener('mouseenter', (e) => {
                const tooltip = document.getElementById(movieCard.id + '-tooltip');
                tooltip.classList.add('show');
            });

            // mouse leaves the area, hide the tooltip
            movieCard.addEventListener('mouseleave', () => {
                const tooltip = document.getElementById(movieCard.id + '-tooltip');
                tooltip.classList.remove('show');
            });

            // mouse is moving around the poster
            movieCard.addEventListener('mousemove', (e) => {
                const tooltip = document.getElementById(movieCard.id + '-tooltip');

                // calculate the position of the tooltip to keep tooltip in viewport
                let left = e.clientX + 15;
                let top = e.clientY - 20;

                // prevent tooltip from going off-screen
                const tooltipRect = tooltip.getBoundingClientRect();
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                
                if (left + 350 > viewportWidth) {
                    left = e.clientX - 365; // Show on left side
                }
                
                if (top + tooltipRect.height > viewportHeight) {
                    top = viewportHeight - tooltipRect.height - 10;
                }
                
                tooltip.style.left = left + 'px';
                tooltip.style.top = top + 'px';
            });
        });
    </script>
</body>
</html>