<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movies</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='movies/home.css') }}">
</head>
<body>
    <div class="gallery-container">
        {# navigation header will be here #}
        <div class="breadcrumbs">
            <a href="{{ url_for('admin.home') }}">Home (Admin)</a> > <span>Movies</span>
        </div>

        {# title of the page #}
        <h1 class="gallery-title">Downloaded Movies!</h1>

        {# shows the gallery of movies #}
        <div class="movie-list">

            {% for movie in movies %}
            {# the individual movie #}
            <div class="movie-card" id="{{ movie.name }}">
                <a href="#">
                    <img class="movie-poster" 
                         src="{{ url_for('static', filename='posters/' + movie.name + '.webp') }}"
                         alt="{{ movie.name }}"
                         loading="lazy">
                    <div class="movie-title-overlay">
                        <h3 class="movie-name">{{ movie.name }}</h3>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>

    {# info for each movie #}
    {% for movie in movies %}
    <div class="tooltip" id="{{ movie.name }}-tooltip">
        {# name and release date #}
        <div class="tooltip-header">
            <div class="tooltip-title">{{ movie.name }}</div>
            <div class="tooltip-year">{{ movie.release_date }}</div>
        </div>

        {# ratings #}
        <div class="tooltip-info">
            <div class="tooltip-info-item">
                <div class="tooltip-info-label">IMDb Rating</div>
                <div class="tooltip-info-value">
                    <span class="tooltip-rating">{{ movie.imdb_rating }}</span>
                </div>
            </div>
            <div class="tooltip-info-item">
                <div class="tooltip-info-label">Rotten Tomatoes Rating</div>
                <div class="tooltip-info-value">
                    <span class="tooltip-rating">{{ movie.rotten_tomatoes_rating }}</span>
                </div>
            </div>
            <div class="tooltip-info-item">
                <div class="tooltip-info-label">Metacritic Rating</div>
                <div class="tooltip-info-value">
                    <span class="tooltip-rating">{{ movie.metacritic_rating }}</span>
                </div>
            </div>
        </div>

        {# genres #}
        <div class="tooltip-info-item">
            <div class="tooltip-info-label">Genre</div>
            <div class="tooltip-info-value">
                {% for genre in movie.genres.split(', ') %}
                    <span class="tooltip-genre">{{ genre }}</span>
                {% endfor %}
            </div>
        </div>
        
        {# description #}
        <div class="tooltip-description">{{ movie.description }}</div>
    </div>
    {% endfor %}

    {# for tool tip #}
    <script>
        // tooltip
        document.querySelectorAll(".movie-card").forEach(movieCard => {
            // mouse enters the area, show the tooltip
            movieCard.addEventListener('mouseenter', (e) => {
                const tooltip = document.getElementById(movieCard.id + '-tooltip');
                tooltip.classList.add('show');
            });

            // mouse leaves the area, hide the tooltip
            movieCard.addEventListener('mouseleave', () => {
                const tooltip = document.getElementById(movieCard.id + '-tooltip');
                tooltip.classList.remove('show');
            });

            // mouse is moving around the poster
            movieCard.addEventListener('mousemove', (e) => {
                const tooltip = document.getElementById(movieCard.id + '-tooltip');

                // calculate the position of the tooltip to keep tooltip in viewport
                let left = e.clientX + 15;
                let top = e.clientY - 20;

                // prevent tooltip from going off-screen
                const tooltipRect = tooltip.getBoundingClientRect();
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                
                if (left + 350 > viewportWidth) {
                    left = e.clientX - 365; // Show on left side
                }
                
                if (top + tooltipRect.height > viewportHeight) {
                    top = viewportHeight - tooltipRect.height - 10;
                }
                
                tooltip.style.left = left + 'px';
                tooltip.style.top = top + 'px';
            });
        });
    </script>
</body>
</html>